/****************************/
/*** Grammar of minishell ***/
/****************************/

%token  WORD
%token  LPAREN       RPAREN
/*      '('          ')'                           */
%token  REDIR_IN   REDIR_OUT    DREDIR_OUT
/*      '<'          '>'            '>>'           */
%token  SQUOTE       DQUOTE
/*      '''          '"'                           */
%token  PIPE
/*      '|'                                        */
%token  AND          OR
/*      '&'          '|'                          */
%token  SEMICON
/*      ';'                                        */
%token  SPACE        TAB
/*      ' '          '\t'                          */

%start expr
%%
expr            : (redirection)*
				| ((redirection)* cmd (redirection | (space arg))* (cmd_sep | expr_end)*)*
                | (LPAREN expr RPAREN (cmd_sep expr | expr_end)*)*
                | (expr_end)*
                ;
redirection     : REDIR_IN file
                | REDIR_OUT file
                | REDIR_OUT REDIR_OUT file
                ;
cmd             : word
                ;
arg             : word
                ;
file            : word
                ;
word            : WORD
                ;
cmd_sep         : ((dbl_and | dbl_or | pipe) expr)*
                ;
expr_end        : SEMICON (expr)*
                ;
dbl_and         : AND AND
                ;
dbl_or          : PIPE PIPE
                ;
pipe            : PIPE
                ;
space           : SPACE
                | TAB
                ;
/* END :) */


////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

%token	REDIR_IN
%token	REDIR_OUT
%token	DREDIR_OUT
%token	WORD
%token	DBL_AND
%token	DBL_OR
%token	PIPE
%token	SEMI
%token	LPAREN
%token	RPAREN

ls;(ls;);

expr			: subshell

subshell		: complexe_cmd
				| LPAREN complexe_cmd RPAREN

complexe_cmd	: simple_cmd
				| simple_cmd DBL_AND
				| simple_cmd DBL_OR
				| simple_cmd DBL_OR

simple_cmd		: cmd
				| cmd PIPE simple_cmd

cmd				: arg
				| arg cmd

arg				: WORD
				| REDIR_IN WORD
				| REDIR_OUT WORD
				| DREDIR_OUT WORD

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


ls | cat && ls ; ls | ls
|                                                                                                                                                                                                 |
|                                                                                                                                                                                                 |
|                                                                                                                                                                                                 |
|                                                                                                                                                                                                 |
|                                                                                                                                                                                                 |
|                                                                                                                                                                                                 |
|                                                      __________________________________________[ ;]__________________________________________                                                   |
|                                                     /                                                                                        \                                                  |
|                               __________________[||]___________________                                                     __________________[||]___________________                           |
|                              /                                         \                                                   /                                         \                          |
|                   _______[ ;]_______                             _______[ ;]_______                             _______[ ;]_______                             _______[ ;]_______               |
|                  /                  \                           /                  \                           /                  \                           /                  \              |
|             _[&&]_                 _[&&]_                  _[&&]_                 _[&&]_                  _[&&]_                 _[&&]_                  _[&&]_                 _[&&]_          |
|            /      \               /      \                /      \               /      \                /      \               /      \                /      \               /      \         |
|        [||]        [||]       [||]        [||]        [||]        [||]       [||]        [||]        [||]        [||]       [||]        [||]        [||]        [||]       [||]        [||]     |
|       /    \      /    \     /    \      /    \      /    \      /    \     /    \      /    \      /    \      /    \     /    \      /    \      /    \      /    \     /    \      /    \    |
|     aa      ab  ac      aa aa      ab  ac      aa  aa      ab  ac      aa aa      ab  ac      aa  aa      ab  ac      aa aa      ab  ac      aa  aa      ab  ac      aa aa      ab  ac      aa  |
|
|                                                                              |
|                                                                              |
|                     |                                                        |
|                    / \                                                       |
|                   ;   ls                                                     |
|                  / \                                                         |
|                &&   ls                                                       |
|               /  \                                                           |
|              |    ls                                                         |
|             / \                                                              |
|           ls   cat                                                           |
|                                                                              |
a && b | c | d | e ; f || g | h | i | j

[;]
L   [&&]
    L   {a}
    R   [|]
        L   [|]
            L   [|]
                L   {b}
                R   {c}
            R   {d}
        R   {e}
R   [||]
    L   {f}
    R   [|]
        L   [|]
            L   [|]
                L   {g}
                R   {h}
            R   {i}
        R   {j}
|                                                                              |
|                                                                              |
|                                                                              |
|               _____[ ;]_____                                                 |
|              /              \                                                |
|          [&&]                [||]                                            |
|         /    \              /    \                                           |
|        a      [ |]         f      [ |]                                       |
|              /    \              /    \                                      |
|          [ |]      e         [ |]      j                                     |
|         /    \              /    \                                           |
|     [ |]      d         [ |]      i                                          |
|    /    \              /    \                                                |
|   b      c            g      h                                               |
|                                                                              |
|                                                                              |
ls ; ls || ls | ls | ls && ls ; ((ls && ls | ls) | ls)
|                                                                              |
|                     ___[ ;]___                                               |
|                   /            \                                             |
|                [ ;]           [()]                                           |
|                /  \             |                                            |
|              ls   [&&]        [ |]                                           |
|                   /  \        /  \                                           |
|                [||]  [ls]   [()]  ls                                         |
|                /  \           |                                              |
|              ls   [ |]      [&&]                                             |
|                   /  \      /  \                                             |
|                 ls    ls  ls  [ |]                                           |
|                               /  \                                           |
|                             ls    ls                                         |

echo | cat ; ls | cat | cat && echo | echo | cat && ls && echo | cat || rm || echo | ls
